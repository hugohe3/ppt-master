# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

PPT Master is an AI-driven SVG presentation generation system that uses a four-role collaboration workflow to transform source documents into professional presentations. This is a **documentation and workflow framework project**, not a traditional codebase with compiled code. The "code" here refers to SVG markup generated by AI agents following structured role definitions.

## Core Architecture

The system operates through a sequential workflow of four specialized AI roles:

1. **Strategist** - Initial intake, content analysis, and design specification
2. **Executor** (General or Consultant) - SVG code generation based on specifications
3. **Optimizer_CRAP** - Visual refinement using CRAP design principles (optional)

### Critical Workflow Rule

**ALWAYS start with Strategist's initial communication phase** before any content analysis:
- Confirm expected page count - **Strategist must provide a suggested page range based on content analysis**
- Identify target audience and use case - **Strategist must provide initial judgment about audience and scenario**
- Select design style: A) General Flexible or B) High-end Consulting - **Strategist must recommend a style with reasoning**

The Strategist should not just ask questions, but actively provide professional suggestions for each confirmation point based on analysis of the source document.

## Development Commands

### Preview Generated SVG Slides
Examples are organized per project under `examples/<project>_<format>_<YYYYMMDD>/svg_output`.

```bash
python3 -m http.server --directory examples/<project>_<format>_<YYYYMMDD>/svg_output 8000
# Open http://localhost:8000 in your browser
```

### Validate SVG Canvas Compliance (multi-format)
```bash
# All SVGs should declare viewBox starting at 0 0
grep -R "viewBox=\"0 0 " examples

# Common formats (extend as needed)
grep -R "viewBox=\"0 0 1280 720\"" examples   # PPT 16:9
grep -R "viewBox=\"0 0 1024 768\"" examples    # PPT 4:3
grep -R "viewBox=\"0 0 1242 1660\"" examples   # Xiaohongshu 3:4
grep -R "viewBox=\"0 0 1080 1080\"" examples   # WeChat/Instagram 1:1
grep -R "viewBox=\"0 0 1080 1920\"" examples   # Story 9:16
grep -R "viewBox=\"0 0 900 383\""  examples   # WeChat header 2.35:1
grep -R "viewBox=\"0 0 1240 1754\"" examples   # A4 150dpi
```
Note: some historical examples may use experimental sizes; prefer `docs/canvas_formats.md` for new work.

### Flatten `<tspan>` (optional post-process)

Executors should use `<tspan>` for manual line breaks at generation time (no `<foreignObject>`). If your publishing or extraction pipeline prefers plain `<text>` nodes, run the built-in flattener:

```bash
# Directory-level (writes to sibling svg_output_flattext by default)
python3 tools/flatten_tspan.py examples/<project_name>_<format>_<YYYYMMDD>/svg_output

# Single-file with custom output path
python3 tools/flatten_tspan.py path/to/input.svg path/to/output.svg
```

Outputs should contain no `<tspan>`, and preserve style/position. Keep using `<tspan>` at generation time.

### Optional Markdown Linting
```bash
npx markdownlint "**/*.md"
```
Run from repository root before committing to maintain consistent formatting.

## Key Technical Constraints

### SVG Generation Rules (Non-negotiable)
- **Canvas**: Use sizes defined in `docs/canvas_formats.md` (PPT 16:9, PPT 4:3, 3:4, 1:1, 9:16, etc.). Ensure `width/height` match `viewBox`.
- **No foreignObject**: Prohibited; use `<tspan>` for manual line breaks
- **Card Height Rules** (General style only):
  - Single-row content: 530-600px height
  - Two-row content: 265-295px per row
- **Background**: Use `<rect>` element at root level
- **Fonts**: System UI font stack preferred

### Style-Specific Approaches

**General Flexible Style**:
- Complete design specification with precise pixel measurements
- Detailed card height planning and validation
- Flexible layout with rich color options

**High-end Consulting Style**:
- Streamlined specification focused on content structure
- Prioritize data visualization (charts, KPIs, matrices, timelines)
- Professional color schemes (Deloitte Blue #0076A8, McKinsey Blue #005587)
- Maximize white space and visual breathing room

## File Organization

### Adding New Roles
- Create role definition in `roles/{RoleName}.md`
- Update `roles/README.md` index
- Synchronize workflow changes in `docs/workflow_tutorial.md`

### Creating Example Projects
```
examples/
└── <project_name>_<format>_<YYYYMMDD>/
    ├── README.md
    ├── design_specification.md / 设计规范与内容大纲.md
    ├── preview.html (optional)
    └── svg_output/
        ├── slide_01_*.svg
        ├── slide_02_*.svg
        └── ...
```

### Work-in-Progress Projects
Place experimental projects in `projects/{project_name}_{YYYYMMDD}/` with:
- **Folder naming**: Must append current date in format `_YYYYMMDD` (e.g., `_20251012`)
- Source document
- Design specification (from Strategist)
- SVG output folder
- Iteration notes in `logs/`

Example: `projects/company_report_20251012/`

## Design Quality Checklist

When reviewing or generating SVG slides:

1. **Alignment**: All elements must align to invisible grid lines
2. **Contrast**: Clear visual hierarchy through size, weight, or color
3. **Repetition**: Consistent styling for similar elements
4. **Proximity**: Related content grouped spatially; unrelated content separated

## Common Tasks

### Generate a New Presentation
1. Run Strategist with source document
2. Complete initial communication (pages, audience, style)
3. Review generated design specification
4. Generate SVG pages sequentially with appropriate Executor
5. Optionally optimize key pages with Optimizer_CRAP

### Modify Existing Role Definitions
- Update role markdown file in `roles/`
- Update `docs/workflow_tutorial.md` if workflow changes
- Update `docs/design_guidelines.md` if design rules change
- Document changes in `CHANGELOG.md`

### Add Sample Projects
- Create a project folder under `examples/` using `{name}_{format}_{YYYYMMDD}`
- Include source document and the Strategist's design specification (markdown)
- Place all SVG outputs under `svg_output/`
- Use naming convention: `slide_0X_topic.svg` (optimized versions prefixed with `yh_`)

## Testing Approach

Since this is a documentation framework:
- **Visual testing**: Open SVG files in browser to verify layout
- **Specification compliance**: Check against `docs/design_guidelines.md`
- **Workflow validation**: Create minimal test scenarios showing agent collaboration
- **Color/font verification**: Ensure values match design specification

## Important Notes for AI Agents

- This project defines AI role behaviors, not executable code
- Focus on maintaining consistency in role definitions
- SVG output quality depends on strict adherence to specifications
- The Strategist's initial communication phase is mandatory, not optional
- **The Strategist must provide professional suggestions for all four confirmation points** (page range, audience/scenario, style choice, and canvas format) based on analysis of the source document
- General and Consulting styles have fundamentally different specification formats
- CRAP optimization is optional but valuable for key slides

## Reference Documentation

- **Quick Start**: README.md
- **Detailed Workflow**: docs/workflow_tutorial.md
- **Design Guidelines**: docs/design_guidelines.md
- **Quick Reference**: docs/quick_reference.md
- **Role Definitions**: roles/*.md
- **Examples**: see `examples/` (project-based folders with svg_output)
